<navigation-bar title="{{mode === 'add' ? 'æ–°å¢èº«ä»½' : 'ç¼–è¾‘èº«ä»½'}}" delta="0" bind:back="onNavigationBack" />

<view class="edit-persona-page">
  <view class="page-content">
    <!-- å¤´åƒé€‰æ‹©åŒºåŸŸ -->
    <view class="form-group avatar-group">
      <view class="form-label">å¤´åƒ</view>

      <!-- å¤´åƒé¢„è§ˆ -->
      <view class="avatar-preview-container">
        <view class="avatar-preview {{!formData.avatarUrl ? 'no-avatar' : 'has-avatar'}}" bindtap="onChooseAvatar">
          <image wx:if="{{formData.avatarUrl}}" src="{{formData.avatarUrl}}" mode="aspectFill" class="avatar-image" />
          <view wx:else class="avatar-placeholder">
            <text class="avatar-icon">ğŸ‘¤</text>
            <text class="avatar-text">ç‚¹å‡»ä¸Šä¼ </text>
          </view>
        </view>

        <!-- æ¢ä¸€ä¸ªé“¾æ¥ï¼ˆä»…åœ¨æœ‰å¤´åƒä¸”æ˜¯éšæœºå¤´åƒæ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{formData.avatarUrl && isRandomAvatar}}" class="avatar-change-hint">
          <text class="avatar-change-link" bindtap="onGetRandomAvatar">æ¢ä¸€ä¸ªï¼Ÿ</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="avatar-actions">
        <!-- éšæœºå¤´åƒæŒ‰é’®ï¼ˆä»…åœ¨æ²¡æœ‰å¤´åƒæ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{!formData.avatarUrl}}" class="avatar-btn random" bindtap="onGetRandomAvatar">
          <text class="btn-icon">ğŸ²</text>
          <text class="btn-text">éšæœºå¤´åƒ</text>
        </view>

        <!-- ä¸Šä¼ /æ›´æ¢å¤´åƒæŒ‰é’® -->
        <view class="avatar-btn primary" bindtap="onChooseAvatar">
          <text class="btn-icon">ğŸ“</text>
          <text class="btn-text">{{formData.avatarUrl ? (isRandomAvatar ? 'æ‰‹åŠ¨ä¸Šä¼ ' : 'æ›´æ¢å¤´åƒ') : 'ä¸Šä¼ å¤´åƒ'}}</text>
        </view>

        <!-- ç§»é™¤æŒ‰é’®ï¼ˆä»…åœ¨æœ‰å¤´åƒæ—¶æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{formData.avatarUrl}}" class="avatar-btn danger" bindtap="onRemoveAvatar">
          <text class="btn-icon">ğŸ—‘ï¸</text>
          <text class="btn-text">ç§»é™¤</text>
        </view>
      </view>

      <view class="avatar-help-text">æ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 5MB</view>
    </view>

    <!-- æ˜µç§°è¾“å…¥ -->
    <view class="form-group">
      <view class="form-label required">æ˜µç§°</view>
      <input
        class="form-input {{errors.name ? 'error' : ''}}"
        type="text"
        placeholder="è¯·è¾“å…¥æ˜µç§°ï¼ˆæœ€å¤š20å­—ï¼‰"
        value="{{formData.name}}"
        maxlength="20"
        bindinput="onNameInput"
      />
      <text wx:if="{{errors.name}}" class="error-text">{{errors.name}}</text>
    </view>

    <!-- ä¸ªäººç®€ä»‹è¾“å…¥ -->
    <view class="form-group">
      <view class="form-label">ä¸ªäººç®€ä»‹</view>
      <textarea
        class="form-textarea {{errors.bio ? 'error' : ''}}"
        placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹ï¼ˆæœ€å¤š200å­—ï¼‰"
        value="{{formData.bio}}"
        maxlength="200"
        bindinput="onBioInput"
        auto-height
      />
      <view class="textarea-counter">{{formData.bio.length}}/200</view>
      <text wx:if="{{errors.bio}}" class="error-text">{{errors.bio}}</text>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="page-footer">
    <view class="btn btn-cancel" bindtap="onCancel">å–æ¶ˆ</view>
    <view class="btn btn-submit {{isSubmitting ? 'disabled' : ''}}" bindtap="onSubmit">
      {{isSubmitting ? 'æäº¤ä¸­...' : 'ç¡®å®š'}}
    </view>
  </view>
</view>


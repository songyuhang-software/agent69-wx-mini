<!--pages/edit-persona/edit-persona.wxml-->
<view class="container">
  <view class="form-container">
    <!-- 昵称输入 -->
    <view class="form-group">
      <view class="form-label">昵称 <text class="required">*</text></view>
      <input
        class="form-input"
        type="text"
        value="{{personaName}}"
        bindinput="onNameInput"
        maxlength="10"
        placeholder="请输入身份昵称(最多10个字)"
      />
      <view class="char-count">{{personaName.length}}/10</view>
    </view>

    <!-- 个人简介输入 -->
    <view class="form-group">
      <view class="form-label">个人简介</view>
      <textarea
        class="form-textarea"
        value="{{personaBio}}"
        bindinput="onBioInput"
        maxlength="200"
        placeholder="请输入个人简介(可选,最多200字)"
        auto-height
      />
      <view class="char-count">{{personaBio.length}}/200</view>
    </view>

    <!-- 头像上传 -->
    <view class="form-group">
      <view class="form-label">头像</view>
      <view class="avatar-section">
        <view class="avatar-preview" bindtap="onChooseAvatar">
          <image
            wx:if="{{personaAvatarUrl}}"
            class="avatar-image"
            src="{{personaAvatarUrl}}"
            mode="aspectFill"
          />
          <view wx:else class="avatar-placeholder">
            <text class="icon-camera">📷</text>
            <text class="placeholder-text">点击上传头像</text>
          </view>
        </view>
        <view class="avatar-actions">
          <!-- 没有头像时显示随机头像按钮 -->
          <button
            wx:if="{{!personaAvatarUrl}}"
            class="btn-random-avatar"
            size="mini"
            bindtap="onRandomAvatar"
          >
            🎲 随机头像
          </button>
          <!-- 上传头像按钮 -->
          <button
            class="btn-upload-avatar"
            size="mini"
            bindtap="onChooseAvatar"
          >
            {{personaAvatarUrl ? '更换头像' : '上传头像'}}
          </button>
          <!-- 有头像时显示移除按钮 -->
          <button
            wx:if="{{personaAvatarUrl}}"
            class="btn-remove-avatar"
            size="mini"
            bindtap="onRemoveAvatar"
          >
            移除
          </button>
          <!-- 有随机头像时显示换一个按钮 -->
          <view wx:if="{{personaAvatarUrl && currentAvatarId}}" class="avatar-change-hint">
            <button
              class="btn-change-avatar"
              size="mini"
              bindtap="onRandomAvatar"
            >
              换一个？
            </button>
          </view>
          <view class="avatar-hint">建议上传正方形图片，支持 JPG、PNG 格式</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="footer-actions">
    <view class="actions-divider"></view>
    <view class="button-group">
      <button class="btn-save" bindtap="onSave" disabled="{{!personaName}}">
        <text class="btn-icon">✓</text>
        {{mode === 'add' ? '创建身份' : '保存修改'}}
      </button>
      <button class="btn-cancel" bindtap="onCancel">取消</button>
    </view>
  </view>
</view>



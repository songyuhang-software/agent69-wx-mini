<!--index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header" style="padding-top: {{safeAreaTop + 8}}px;">
    <text class="header-title">ğŸ’¡ çµæ„Ÿç¬”è®°</text>
  </view>

  <!-- çŠ¶æ€æç¤º -->
  <view wx:if="{{statusVisible}}" class="status {{statusType}}" style="top: {{headerHeight}}px;">
    <text>{{statusMessage}}</text>
  </view>

  <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
  <scroll-view
    class="chat-container"
    style="top: {{headerHeight}}px; bottom: {{safeAreaBottom + 58}}px;"
    scroll-y
    scroll-into-view="{{scrollToView}}"
    scroll-with-animation="{{true}}"
    bindscrolltoupper="onScrollToUpper"
    upper-threshold="50"
  >
    <view class="messages-wrapper">
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{isLoadingMore}}" class="loading-more">
        <text>åŠ è½½ä¸­...</text>
      </view>

      <!-- æ¶ˆæ¯åˆ—è¡¨ -->
      <view
        wx:for="{{messages}}"
        wx:key="id"
        id="msg-{{item.id}}"
        class="message-wrapper {{item.role}}-wrapper"
      >
        <view class="message {{item.role}}-message {{item.isWelcome ? 'welcome-message' : ''}}">
          <text class="message-content">{{item.content}}</text>
          <text class="timestamp">{{item.timestamp}}</text>
        </view>
      </view>

      <!-- åŠ è½½ä¸­æ¶ˆæ¯ -->
      <view wx:if="{{isLoading}}" class="message-wrapper assistant-wrapper">
        <view class="message assistant-message loading">
          <text>AIæ­£åœ¨æ€è€ƒä¸­...</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-area" style="padding-bottom: {{safeAreaBottom + 12}}px;">
    <input
      class="input-field"
      type="text"
      value="{{inputValue}}"
      placeholder="è¾“å…¥ä½ çš„æƒ³æ³•..."
      bindinput="onInput"
      bindconfirm="onSendMessage"
      confirm-type="send"
    />
    <view
      class="send-button {{isSending ? 'sending' : (!inputValue ? 'disabled' : '')}}"
      bindtap="onSendMessage"
    >
      <view class="arrow-icon">â†‘</view>
    </view>
  </view>
</view>











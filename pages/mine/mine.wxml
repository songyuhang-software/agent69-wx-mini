<!--pages/mine/mine.wxml-->
<navigation-bar title="æˆ‘çš„" back="{{false}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
    <view class="user-info-section">
      <view class="user-avatar-section">
        <view class="user-avatar-large {{!userDetail.personaAvatarUrl ? 'default' : ''}}" bindtap="onAvatarTap">
          <image wx:if="{{userDetail.personaAvatarUrl}}" src="{{userDetail.personaAvatarUrl}}" mode="aspectFill" />
          <text wx:else>é»˜è®¤</text>
        </view>
        <view class="user-basic-info">
          <text class="user-name">{{userDetail.personaName || userDetail.username || 'æœªè®¾ç½®'}}</text>
          <view class="username-line">
            <text class="username">@{{userDetail.username || 'æœªè®¾ç½®'}}</text>
            <text wx:if="{{!userDetail.username}}" class="account-action-link" bindtap="onSupplementAccount">è¡¥å…¨è´¦å·</text>
            <text wx:else class="account-action-link" bindtap="onChangePassword">ä¿®æ”¹å¯†ç </text>
          </view>
        </view>
      </view>
      <text class="user-bio">{{userDetail.personaBio || 'è¿™ä¸ªäººå¾ˆæ‡’,ä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹...'}}</text>
      <view class="user-footer-actions">
        <button class="logout-btn" bindtap="onLogout">é€€å‡ºç™»å½•</button>
      </view>
    </view>

    <!-- è´¦æˆ·ä¿¡æ¯åŒºåŸŸ -->
    <view class="detail-section">
      <text class="section-title">è´¦æˆ·ä¿¡æ¯</text>
      <view class="detail-card" bindtap="onEmailAction">
        <text class="detail-icon">ğŸ“§</text>
        <view class="detail-content">
          <text class="detail-label">é‚®ç®±</text>
          <view class="detail-value">
            <text>{{userDetail.email || 'æœªè®¾ç½®'}}</text>
            <button class="action-small-btn {{userDetail.email ? 'danger' : ''}}" catchtap="onEmailAction">
              {{userDetail.email ? 'è§£ç»‘' : 'ç»‘å®š'}}
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- èº«ä»½ç®¡ç†åŒºåŸŸ -->
    <view class="personas-section">
      <view class="personas-header">
        <text class="personas-title">èº«ä»½ç®¡ç†</text>
        <button class="add-persona-btn" bindtap="onAddPersona">
          <text>+</text>
          <text>æ–°å¢èº«ä»½</text>
        </button>
      </view>

      <view class="personas-list">
        <!-- å½“å‰èº«ä»½ -->
        <view class="persona-card current">
          <view class="persona-header">
            <view class="persona-info">
              <view class="persona-avatar-small {{!userDetail.personaAvatarUrl ? 'default' : ''}}">
                <image wx:if="{{userDetail.personaAvatarUrl}}" src="{{userDetail.personaAvatarUrl}}" mode="aspectFill" />
                <text wx:else>é»˜è®¤</text>
              </view>
              <view class="persona-details">
                <view class="persona-name-row">
                  <text class="persona-name">{{userDetail.personaName || 'æœªè®¾ç½®æ˜µç§°'}}</text>
                  <view class="current-badge">
                    <text class="star-icon">â­</text>
                    <text>å½“å‰é»˜è®¤</text>
                  </view>
                </view>
                <text class="persona-bio">{{userDetail.personaBio || 'è¿™ä¸ªäººå¾ˆæ‡’,ä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹...'}}</text>
              </view>
            </view>
            <view class="persona-actions">
              <button class="action-icon-btn edit" bindtap="onEditCurrentPersona">âœï¸</button>
            </view>
          </view>
        </view>

        <!-- å…¶ä»–èº«ä»½ -->
        <block wx:if="{{userDetail.otherPersonas && userDetail.otherPersonas.length > 0}}">
          <view class="persona-card" wx:for="{{userDetail.otherPersonas}}" wx:key="personaId" data-persona="{{item}}">
            <view class="persona-header">
              <view class="persona-info">
                <view class="persona-avatar-small {{!item.avatarUrl ? 'default' : ''}}">
                  <image wx:if="{{item.avatarUrl}}" src="{{item.avatarUrl}}" mode="aspectFill" />
                  <text wx:else>é»˜è®¤</text>
                </view>
                <view class="persona-details">
                  <view class="persona-name-row">
                    <text class="persona-name">{{item.name}}</text>
                  </view>
                  <text class="persona-bio">{{item.bio || 'è¿™ä¸ªäººå¾ˆæ‡’,ä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹...'}}</text>
                </view>
              </view>
              <view class="persona-actions">
                <button class="action-icon-btn set-default" bindtap="onSetDefaultPersona" data-persona="{{item}}">â­</button>
                <button class="action-icon-btn edit" bindtap="onEditPersona" data-persona="{{item}}">âœï¸</button>
                <button class="action-icon-btn delete" bindtap="onDeletePersona" data-persona="{{item}}">ğŸ—‘ï¸</button>
              </view>
            </view>
          </view>
        </block>
        <view wx:else class="empty-personas">
          <text>æš‚æ— å…¶ä»–èº«ä»½</text>
        </view>
      </view>
    </view>

    <!-- è´¦å·æ“ä½œåŒºåŸŸ -->
    <view class="account-actions-section">
      <button class="account-actions-toggle {{accountActionsExpanded ? 'active' : ''}}" bindtap="onToggleAccountActions">
        <text class="toggle-text">è´¦å·ä¸å®‰å…¨</text>
        <text class="toggle-icon">â–¼</text>
      </button>
      <view class="account-actions-content {{accountActionsExpanded ? 'show' : ''}}" wx:if="{{accountActionsExpanded}}">
        <button class="account-action-item delete-account-item" bindtap="onDeleteAccount">
          <text class="action-label">æ³¨é”€è´¦å·</text>
          <text class="action-arrow">â€º</text>
        </button>
      </view>
    </view>
  </view>
</scroll-view>
